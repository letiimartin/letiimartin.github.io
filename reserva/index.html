<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Proceso de reserva para viviendas de Barsant Promociones. Complete su reserva en 4 sencillos pasos.">
    <title>Proceso de Reserva | Barsant Promociones</title>
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Estilos -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    <style>
        /* Estilos específicos para el proceso de reserva */
        .reservation-header {
            background-color: var(--light-bg);
            padding: 60px 0 30px;
            text-align: center;
            margin-top: 80px;
        }
        
        .reservation-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .reservation-subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .reservation-process {
            padding: 60px 0;
        }
        
        .process-container {
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
        }
        
        .step-content {
            margin-top: 40px;
        }
        
        .step-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .step-description {
            margin-bottom: 30px;
            color: #666;
        }
        
        .security-notice {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        
        .security-notice i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        
        .btn-back {
            color: #666;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-back:hover {
            color: var(--primary-color);
        }
        
        .file-upload {
            margin-bottom: 20px;
        }
        
        .file-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-label:hover {
            border-color: var(--secondary-color);
        }
        
        .file-upload-label i {
            font-size: 2rem;
            color: #999;
            margin-bottom: 10px;
            display: block;
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .bank-details {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }
        
        .bank-details h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .bank-details p {
            margin-bottom: 10px;
        }
        
        .bank-details .note {
            font-style: italic;
            margin-top: 15px;
            color: #666;
        }
        
        .confirmation-message {
            text-align: center;
            padding: 30px 0;
        }
        
        .confirmation-icon {
            font-size: 5rem;
            color: #28a745;
            margin-bottom: 20px;
        }
        
        .confirmation-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .confirmation-text {
            margin-bottom: 30px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .process-container {
                padding: 20px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .actions {
                flex-direction: column;
                gap: 20px;
            }
            
            .actions .btn-back {
                order: 2;
                justify-content: center;
            }
            
            .actions .btn-primary {
                order: 1;
            }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="header-container"></div>

    <div class="reservation-header">
        <div class="container">
            <h1 class="reservation-title">Proceso de Reserva</h1>
            <p class="reservation-subtitle">Sigue los pasos a continuación para completar la reserva de tu vivienda con total seguridad y transparencia.</p>
        </div>
    </div>

    <div id="property-summary-container"></div>

    <section class="reservation-process">
        <div class="container">
            <div class="process-container">
                <div id="steps-container"></div>

                <!-- Step 1: Information -->
                <div class="step-content" id="step1-content">
                    <h2 class="step-title">Información y Datos Personales</h2>
                    <p class="step-description">Cuéntanos un poco sobre ti para comenzar el proceso de reserva de la vivienda seleccionada.</p>
                    
                    <div class="security-notice">
                        <i class="fas fa-lock"></i>
                        <p>Tu información está segura. Utilizamos cifrado SSL para proteger tus datos.</p>
                    </div>
                    
                    <form id="reservation-step1-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombre">Nombre *</label>
                                <input type="text" id="nombre" name="nombre" required>
                            </div>
                            <div class="form-group">
                                <label for="apellidos">Apellidos *</label>
                                <input type="text" id="apellidos" name="apellidos" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="telefono">Teléfono *</label>
                                <input type="tel" id="telefono" name="telefono" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dni">DNI/NIE *</label>
                                <input type="text" id="dni" name="dni" required>
                            </div>
                            <div class="form-group">
                                <label for="direccion">Dirección *</label>
                                <input type="text" id="direccion" name="direccion" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ciudad">Ciudad *</label>
                                <input type="text" id="ciudad" name="ciudad" required>
                            </div>
                            <div class="form-group">
                                <label for="codigo_postal">Código Postal *</label>
                                <input type="text" id="codigo_postal" name="codigo_postal" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="comentarios">Comentarios adicionales</label>
                            <textarea id="comentarios" name="comentarios" rows="4"></textarea>
                        </div>
                        
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="terms" name="terms" required>
                            <label for="terms">He leído y acepto los <a href="/legal/politica-privacidad.html" target="_blank">términos y condiciones</a> *</label>
                        </div>
                        
                        <div id="documents-container"></div>

                        <div class="actions">
                            <a href="javascript:history.back()" class="btn-back">Cancelar</a>
                            <button type="submit" class="cta-button" id="go-to-step2">Continuar</button>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Contrato y Firma -->
                <div class="step-content" id="step2-content" style="display: none;">
                    <h2 class="step-title">Contrato de Reserva y Firma</h2>
                    <p class="step-description">Revisa y firma el contrato de reserva para la vivienda seleccionada.</p>
                    
                    <div class="contract-preview">
                        <h3>Contrato de Reserva</h3>
                        <p>El contrato de reserva será generado con tus datos y enviado a través de DocuSign para su firma electrónica.</p>
                        
                        <div class="docusign-info">
                            <div class="docusign-logo">
                                <i class="fas fa-file-signature"></i>
                            </div>
                            <div class="docusign-text">
                                <h4>Firma Electrónica con DocuSign</h4>
                                <p>Utilizamos DocuSign para la firma electrónica de documentos, garantizando la validez legal y la seguridad de todo el proceso.</p>
                                <p>Recibirás un email con el enlace para revisar y firmar el contrato de reserva.</p>
                            </div>
                        </div>
                        
                        <div class="contract-summary">
                            <h4>Resumen del Contrato</h4>
                            <ul>
                                <li><strong>Vivienda:</strong> <span id="contract-property">Vivienda A Cuarto A</span></li>
                                <li><strong>Precio:</strong> <span id="contract-price">€394.840</span></li>
                                <li><strong>Importe de reserva:</strong> €6.000</li>
                                <li><strong>Plazo de firma:</strong> 3 días hábiles</li>
                            </ul>
                        </div>
                        
                        <!-- Botón para ver el contrato -->
                        <div style="margin-top: 20px;">
                            <button type="button" class="cta-button" id="view-contract-btn">
                                <i class="fas fa-file-pdf"></i> Ver Contrato de Reserva
                            </button>
                        </div>
                    </div>
                    
                    <!-- Modal para mostrar el contrato -->
                    <div id="contract-modal" class="modal" style="display:none;">
                        <div class="modal-content">
                            <span class="close-modal" id="close-contract-modal">&times;</span>
                            <h2>Ejemplo de Contrato de Reserva</h2>
                            <p>Este es un ejemplo del contrato de reserva. El documento final se personalizará con tus datos y se enviará para firma electrónica.</p>
                            <ul>
                                <li><b>Promotora:</b> Barsant Promociones Inmobiliarias, S.L.</li>
                                <li><b>Comprador:</b> [Tus datos]</li>
                                <li><b>Vivienda:</b> <span id="modal-contract-property"></span></li>
                                <li><b>Precio:</b> <span id="modal-contract-price"></span></li>
                                <li><b>Importe de reserva:</b> €6.000</li>
                                <li><b>Condiciones:</b> La reserva está sujeta a la firma del contrato definitivo y la aprobación de la financiación.</li>
                            </ul>
                            <p>Para más detalles, contacta con nuestro equipo comercial.</p>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <a href="#" class="btn-back" id="back-to-step1"><i class="fas fa-arrow-left"></i> Volver</a>
                        <button type="button" class="cta-button" id="go-to-step3">Continuar a Pago</button>
                    </div>
                </div>

                <!-- Step 3: Pago -->
                <div class="step-content" id="step3-content" style="display: none;">
                    <h2 class="step-title">Pago de la Reserva</h2>
                    <p class="step-description">Realiza el pago de la reserva mediante transferencia bancaria y sube el justificante.</p>
                    
                    <div class="bank-details">
                        <h4>Datos Bancarios para la Transferencia</h4>
                        <p><strong>Beneficiario:</strong> Barsant Promociones Inmobiliarias, S.L.</p>
                        <p><strong>Banco:</strong> Banco Santander</p>
                        <p><strong>IBAN:</strong> ES12 3456 7890 1234 5678 9012</p>
                        <p><strong>BIC/SWIFT:</strong> BSCHESMMXXX</p>
                        <p><strong>Importe:</strong> €6.000</p>
                        <p><strong>Concepto:</strong> Reserva <span id="payment-property">Vivienda A Cuarto A</span> - <span id="payment-name">[Tu nombre]</span></p>
                        
                        <p class="note">Importante: El pago debe realizarse desde una cuenta bancaria a nombre del titular de la reserva.</p>
                    </div>
                    
                    <div class="file-upload">
                        <h4>Subir Justificante de Pago</h4>
                        <p>Una vez realizada la transferencia, sube el justificante de pago:</p>
                        
                        <label for="payment-proof" class="file-upload-label">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Haz clic aquí para subir el justificante</span>
                            <span class="file-format">(Formatos aceptados: PDF, JPG, PNG)</span>
                        </label>
                        <input type="file" id="payment-proof" name="payment-proof" accept=".pdf,.jpg,.jpeg,.png">
                        
                        <div id="file-preview" style="display: none;">
                            <h5>Archivo seleccionado:</h5>
                            <p id="file-name"></p>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <a href="#" class="btn-back" id="back-to-step2"><i class="fas fa-arrow-left"></i> Volver</a>
                        <button type="button" class="cta-button" id="go-to-step4">Finalizar Reserva</button>
                    </div>
                </div>

                <!-- Step 4: Confirmación -->
                <div class="step-content" id="step4-content" style="display: none;">
                    <div class="confirmation-message">
                        <div class="confirmation-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2 class="confirmation-title">¡Reserva Completada con Éxito!</h2>
                        <p class="confirmation-text">Gracias por confiar en Barsant Promociones. Hemos recibido tu solicitud de reserva y en breve recibirás un email con la confirmación y el certificado de reserva.</p>
                        
                        <div class="next-steps">
                            <h3>Próximos Pasos</h3>
                            <ol>
                                <li>Recibirás un email con el contrato de reserva para firmar electrónicamente.</li>
                                <li>Una vez verificado el pago y firmado el contrato, recibirás el certificado de reserva.</li>
                                <li>Nuestro equipo comercial se pondrá en contacto contigo para resolver cualquier duda.</li>
                            </ol>
                        </div>
                        
                        <a href="../index.html" class="cta-button">Volver a Inicio</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="../assets/js/utils.js"></script>
    <script src="../components/components.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar componentes
            document.getElementById('header-container').innerHTML = BarsantComponents.getHeader();
            document.getElementById('footer-container').innerHTML = BarsantComponents.getFooter();
            document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(1);
            document.getElementById('documents-container').innerHTML = BarsantComponents.getDocumentsList();
            
            // Cargar datos de la propiedad desde URL
            const propertyTitle = window.barsantUtils.getUrlParameter('vivienda') || 'Vivienda A Cuarto A';
            const propertyPrice = window.barsantUtils.getUrlParameter('precio') || '394.840';
            const propertySpecs = window.barsantUtils.getUrlParameter('info') || '2 dormitorios · 2 baños · 68.61 m² útiles · 98.71 m² construidos';
            
            // Mostrar resumen de la propiedad
            document.getElementById('property-summary-container').innerHTML = 
                BarsantComponents.getPropertySummary(propertyTitle, propertySpecs, propertyPrice);
            
            // Actualizar datos en los pasos
            document.getElementById('contract-property').textContent = propertyTitle;
            document.getElementById('contract-price').textContent = propertyPrice;
            document.getElementById('payment-property').textContent = propertyTitle;
            
            // Navegación entre pasos
            const step1Form = document.getElementById('reservation-step1-form');
            const step1Content = document.getElementById('step1-content');
            const step2Content = document.getElementById('step2-content');
            const step3Content = document.getElementById('step3-content');
            const step4Content = document.getElementById('step4-content');
            
            // Paso 1 a Paso 2
            step1Form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar formulario
                let isValid = true;
                const requiredFields = step1Form.querySelectorAll('[required]');
                
                requiredFields.forEach(field => {
                    const fieldType = field.type === 'email' ? 'email' : 
                                    field.id.includes('telefono') ? 'phone' :
                                    field.id.includes('dni') ? 'dni' : 'text';
                    
                    if (!window.barsantUtils.validateField(field.id, fieldType)) {
                        isValid = false;
                    }
                });
                
                if (isValid) {
                    // Actualizar nombre en paso de pago
                    document.getElementById('payment-name').textContent = 
                        document.getElementById('nombre').value + ' ' + document.getElementById('apellidos').value;
                    
                    // Mostrar paso 2
                    step1Content.style.display = 'none';
                    step2Content.style.display = 'block';
                    document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(2);
                    window.scrollTo(0, 0);
                }
            });
            
            // Volver de Paso 2 a Paso 1
            document.getElementById('back-to-step1').addEventListener('click', function(e) {
                e.preventDefault();
                step2Content.style.display = 'none';
                step1Content.style.display = 'block';
                document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(1);
                window.scrollTo(0, 0);
            });
            
            // Paso 2 a Paso 3
            document.getElementById('go-to-step3').addEventListener('click', function() {
                step2Content.style.display = 'none';
                step3Content.style.display = 'block';
                document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(3);
                window.scrollTo(0, 0);
            });
            
            // Volver de Paso 3 a Paso 2
            document.getElementById('back-to-step2').addEventListener('click', function(e) {
                e.preventDefault();
                step3Content.style.display = 'none';
                step2Content.style.display = 'block';
                document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(2);
                window.scrollTo(0, 0);
            });
            
            // Paso 3 a Paso 4
            document.getElementById('go-to-step4').addEventListener('click', function() {
                step3Content.style.display = 'none';
                step4Content.style.display = 'block';
                document.getElementById('steps-container').innerHTML = BarsantComponents.getReservationSteps(4);
                window.scrollTo(0, 0);
            });
            
            // Previsualización de archivo
            const paymentProofInput = document.getElementById('payment-proof');
            const filePreview = document.getElementById('file-preview');
            const fileName = document.getElementById('file-name');
            
            paymentProofInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    fileName.textContent = this.files[0].name;
                    filePreview.style.display = 'block';
                } else {
                    filePreview.style.display = 'none';
                }
            });
            
            // Mostrar modal de contrato
            document.getElementById('view-contract-btn').addEventListener('click', function() {
                document.getElementById('modal-contract-property').textContent = document.getElementById('contract-property').textContent;
                document.getElementById('modal-contract-price').textContent = document.getElementById('contract-price').textContent;
                document.getElementById('contract-modal').style.display = 'block';
            });
            document.getElementById('close-contract-modal').addEventListener('click', function() {
                document.getElementById('contract-modal').style.display = 'none';
            });
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('contract-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
